import{m as d,p as C,q as m,s as N,g as n,o as i,a as _,d as T,h as S,w as U,b as e,F as h,x as y,n as p,t as g,k as D,y as M,z as $,A as z}from"./app-BSx8ZyyL.js";import{_ as B}from"./AuthenticatedLayout-ZsaCHYCi.js";import"./ApplicationLogo-CxPfebQC.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const E={class:"py-12"},L={class:"mx-auto max-w-7xl sm:px-6 lg:px-8"},V={class:"bg-white shadow-sm sm:rounded-lg"},A={class:"p-6 text-gray-900"},F={class:"flex border rounded-lg h-[600px] overflow-hidden"},K={class:"w-1/3 border-r overflow-y-auto bg-white"},j=["onClick"],q={class:"w-2/3 flex flex-col bg-gray-50"},H={key:0},R={class:"p-4 border-b font-semibold bg-gray-100 sticky top-0 z-10"},G={class:"text-xs text-gray-500 mt-1"},I={class:"flex border-t p-3 bg-white"},J={key:1,class:"text-gray-500 h-full flex items-center justify-center text-xl",style:{"min-height":"400px"}},Y={__name:"Dashboard",props:{users:Array},setup(f){const o=d(null),l=d(null),r=d(""),c=d([]),u=d(null),v=()=>{z(()=>{u.value&&(u.value.scrollTop=u.value.scrollHeight)})},w=async a=>{o.value=a;const t=await m.get(`/messages/${a.id}`);c.value=t.data,v()},b=async()=>{if(!r.value.trim()||!o.value)return;const a=await m.post("/messages",{receiver_id:o.value.id,message:r.value});c.value.push(a.data),r.value="",v()},k=a=>new Date(a).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});let x=null;return C(async()=>{const a=await m.get("/user");l.value=a.data,console.log("ðŸ”Œ Subscribing to private channel: chat."+l.value.id),x=window.Echo.private(`chat.${l.value.id}`).listen("MessageSent",t=>{console.log("ðŸ“¡ Real-time message received:",t.message),o.value&&Number(t.message.sender_id)===Number(o.value.id)&&(c.value.push(t.message),v())}),v()}),N(()=>{x&&l.value&&(console.log("ðŸ”Œ Leaving channel: chat."+l.value.id),window.Echo.leave(`chat.${l.value.id}`))}),(a,t)=>(i(),n(h,null,[_(T(S),{title:"Dashboard"}),_(B,null,{default:U(()=>[e("div",E,[e("div",L,[e("div",V,[e("div",A,[e("div",F,[e("div",K,[t[1]||(t[1]=e("div",{class:"p-4 font-semibold border-b bg-gray-100 sticky top-0 z-10"}," Users ",-1)),e("ul",null,[(i(!0),n(h,null,y(f.users,s=>(i(),n("li",{key:s.id,onClick:O=>w(s),class:p(["cursor-pointer px-4 py-2 hover:bg-gray-100",{"bg-gray-100 font-bold":o.value?.id===s.id}])},g(s.name),11,j))),128))])]),e("div",q,[o.value?(i(),n("div",H,[e("div",R," Chat with "+g(o.value?.name),1),e("div",{ref_key:"messageContainer",ref:u,class:"flex-1 overflow-y-auto p-4 space-y-2"},[(i(!0),n(h,null,y(c.value,s=>(i(),n("div",{key:s.id,class:p(["flex flex-col mb-2",Number(s.sender_id)===Number(l.value.id)?"items-end":"items-start"])},[e("div",{class:p(["px-3 py-2 rounded max-w-[70%]",Number(s.sender_id)===Number(l.value.id)?"bg-blue-500 text-white":"bg-gray-300 text-gray-800"])},g(s.message),3),e("span",G,g(k(s.created_at)),1)],2))),128))],512),e("div",I,[D(e("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=s=>r.value=s),onKeyup:M(b,["enter"]),class:"flex-1 border rounded-l px-4 py-2 focus:outline-none",placeholder:"Type your message..."},null,544),[[$,r.value]]),e("button",{onClick:b,class:"bg-blue-600 text-white px-4 py-2 rounded-r hover:bg-blue-700"}," Send ")])])):(i(),n("div",J," Select a user to start chatting "))])])])])])])]),_:1})],64))}};export{Y as default};
